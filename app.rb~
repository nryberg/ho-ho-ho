require 'rubygems'
require 'compass'
require 'sinatra'
require 'partials'
require 'mongo_mapper'
require 'Play'
require 'Map'

helpers Sinatra::Partials

MongoMapper.connection = Mongo::Connection.new('192.168.0.100', 27017) 
MongoMapper.database = 'holiday'
get '/' do
  @plays = Play.limit(20).sort(:title)
  haml :index
end

get '/titles' do
  map = Map.new(Play.collection)
  coll = map.count_by("title")
  @results = coll.find({}).sort([["value", -1]])
  haml :titles
end

get '/cities' do
  map = Map.new(Play.collection)
  coll = map.count_by("city")
  @results = coll.find({}).sort([["value", -1]])
end



get '/hi' do
  "Hello World!"
end